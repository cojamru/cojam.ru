AddDefaultCharset utf-8
Options All -Indexes
ErrorDocument 404 /error.html
ErrorDocument 403 /error.html

RewriteEngine on
RewriteBase /
RewriteCond %{THE_REQUEST} ^[A-Z]{3,9}\ /([^.]+)\.html\ HTTP
RewriteRule ^([^.]+)\.html$ /$1 [R=301,L]
RewriteCond %{REQUEST_URI} !(\.[^./]+)$
RewriteCond %{REQUEST_fileNAME} !-d
RewriteCond %{REQUEST_fileNAME} !-f
RewriteRule (.*) /$1.html [L]

RewriteEngine on
RewriteCond %{HTTP_HOST} ^www\.
RewriteCond %{HTTPS}s ^on(s)|off
RewriteCond http%1://%{HTTP_HOST} ^(https?://)(www\.)?(.+)$
RewriteRule ^ %1%3%{REQUEST_URI} [R=301,L]

RewriteEngine on
RewriteCond %{HTTPS} !on
RewriteRule (.*) https://%{HTTP_HOST}%{REQUEST_URI}

<IfModule mod_headers.c>
Header set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" env=HTTPS

Header set Content-Security-Policy "default-src 'self'; \
 connect-src 'self' https://mc.yandex.ru; \
 child-src 'self' https://bandcamp.com https://w.soundcloud.com; \
 frame-ancestors 'self'; \
 style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com; \
 font-src 'self' https://fonts.gstatic.com; \
 img-src 'self' data: https://www.google-analytics.com https://mc.yandex.ru https://mc.yandex.ru; \
 media-src 'self'; \
 script-src 'self' 'unsafe-inline' https://www.google-analytics.com https://www.googletagmanager.com https://mc.yandex.ru https://cdnjs.cloudflare.com https://cdnjs.cloudflare.com https://vk.com https://graph.facebook.com; \
 object-src 'self'; \
 plugin-types application/x-shockwave-flash"
</IfModule>

# fallbacks to old site
RedirectMatch 301 /music/(.*\.mp3)$ https://old.cojam.ru/audio/$1
Redirect 301 /wp-content/uploads/ https://old.cojam.ru/wp-content/uploads/
RedirectMatch 301 /games/(.*?)$ /games
